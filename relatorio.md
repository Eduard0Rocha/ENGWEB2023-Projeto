# Universidade do Minho

## Escola de Engenharia

![Escola de Engenharia - UMinho](data:image/png;base64,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)

# Plataforma de Gestão e Disponibilização de Recursos Educativos

### Engenharia Web - 2023

### Relatório do Trabalho Prático 

##### José Eduardo da Cunha Rocha - A97270

# Índice

1. [Introdução](#introdução)
2. [Contextualização e Objetivos](#contextualização-e-objetivos)
3. [Implementação física](#implementação-física)
4. [Trabalho futuro](#trabalho-futuro)
5. [Conclusão](#conclusão)
6. [Anexos](#anexos)

# Introdução

Para a realização deste projeto, foi escolhida a Proposta 1: Plataforma de Gestão e Disponibilização de Recursos Educativos.

O objetivo principal foi desenvolver um serviço web capaz de armazenar recursos educativos e disponibilizá-los quando solicitados, bem como adicionar e remover recursos.

# Contextualização e Objetivos

O sistema a ser desenvolvido tem como principal objetivo permitir o acesso de conteúdo educacional a diversos alunos de diversos professores. Os alunos podem também comentar os recursos disponibilizados, sugerindo melhorias ou elogiando o recurso do professor, deixando mensagens positivas.

Neste sistema existem três tipos de utilizadores: administradores, produtores e consumidores.

O produtor poderá inserir documentos no sistema e definir quem pode aceder àquele documento, por exemplo, pode criar um recurso para alunos de Engenharia Informática da Universidade do Minho.

O produtor poderá também consultar os comentários e rankings feitos por alunos a um determinado recurso.

Para além disso, o produtor terá acesso a uma página de consumidor.
O consumidor poderá aceder e descarregar recursos educativos a que tem acesso na plataforma. Poderá também avaliar os recursos.

O consumidor poderá também aceder a um placar de notícias sobre novas publicações de produtores de conteúdo.

O administrador poderá consultar todos os recursos publicados bem como eliminar recursos.

# Implementação física

## Autenticação

O primeiro passo para implementar a autenticação foi criar os modelos do utilizador na base de dados e o respetivo código (“controllers”) para aceder a informação na mesma.

Ainda na API foram criadas as rotas de login e registo que criam uma sessão para o utilizador e enviam um JSON Web Token correspondente para a origem do pedido. As rotas de obter a informação completa de um utilizador e eliminar um utilizador foram protegidas e apenas respondem a pedidos cujo token corresponda à sessão do usuário em questão ou a um administrador.

Na interface, o utilizador (ainda sem cookies) é redirecionado, ao entrar, para a rota de login onde pode criar uma conta (de Produtor ou Consumidor) ou efetuar o registo caso tenha uma conta existente. Em seguida, é direcionado para a página que corresponde ao seu nível (Consumidor, Produtor ou Administrador). Para fortalecer a segurança, não é permitido criar mais administradores, apenas o próprio pode adicionar mais na base de dados manualmente.

Neste sistema existe uma hierarquia em que o Administrador do sistema ocupa o topo e o Consumidor a base. As rotas das páginas estão protegidas de forma a que o utilizador que as possa aceder não esteja abaixo da hierarquia da página em questão.

Uma vez que o código da interface corre do lado do servidor, apenas fornecendo páginas HTML (e folhas de estilo), ao efetuar login/registo é enviada uma página HTML para o navegador com um script cujo propósito é guardar o token como uma cookie no navegador e de seguida redirecionar para a rota “/index” que redireciona para a rota da página correspondente considerando o nível.

## Ingestão e armazenamento de pacotes

Começou por ser criada a página que apresenta um formulário para a ingestão do pacote com todos os campos do mesmo bem como uma explicação da estrutura dos pacotes.

Os pacotes (com a extensão ".zip") devem ter um ficheiro manifest.txt com o caminho para todos os recursos na mesma diretoria.

Após preencher e enviar o formulário para o servidor Interface, este guarda o pacote localmente e envia apenas os metadados do ficheiro para o servidor API.

O servidor API guarda a informação na base de dados e em seguida requisita o pacote através de uma rota na API protegida por uma chave que apenas os servidores conhecem.

Após a Interface fornecer o pacote por "File Stream", este é eliminado da Interface.

De seguida, a API descarrega o pacote, descomprime e elimina o pacote comprimido.

De forma a manter a consistência dos pacotes no sistema, o servidor API analisa o pacote procurando pelas seguintes situações: ficheiro manifest.txt não encontrado; ficheiros referidos no manifesto que não existem e ficheiros no pacote que não são referidos no manifesto. Se houver um erro, o pacote é eliminado do sistema e é removido o registo da base de dados.

Por último, a API fornece o relatório de ingestão e armazenamento à Interface que renderiza os resultados, quer seja um aviso (num quadrado amarelo) ou a confirmação de um processo bem sucedido (quadrado verde).

## Página de utilizador

Para a página de informações do utilizador, é apresentada a informação relevante sobre o mesmo (obtida da base de dados) e são apresentadas três operações para realizar sobre a conta de utilizador:

- Logout: Elimina a cookie com o token de autenticação do servidor e redireciona para a página de login;

- Mudar password: Faz um pedido à API para alterar a password. Quando o processo é concluído, é apresentada a mensagem de confirmação;

- Eliminar a conta: Faz um pedido à API para eliminar a conta. Quando o processo é concluído, o utilizador é redirecionado para a página de login.


## Página do Consumidor

Na página do consumidor foi feito um formulário de pesquisa que permite pesquisar por tema e/ou produtor.

Os resultados apresentados contêm a informação relevante de cada ficheiro a que o consumidor pode aceder bem como um botão de download e uma secção de comentários.

O pedido do download é realizado no browser que contacta diretamente o servidor API. Este comprime o ficheiro correspondente, envia ao browser e, de seguida, elimina o ficheiro comprimido.

Para implementar os comentários foi criado um novo modelo (e uma nova coleção) na base de dados para armazenar esta informação.

Na página do consumidor é possível ver os comentários e ranks atribuídos por outros utilizadores e também pelo mesmo.

Se o utilizador ainda não tiver comentado/classificado, este pode adicionar comentários. Caso contrário apenas aparece a opção de eliminar o comentário anteriormente publicado.

Através dos ranks atribuídos pelos consumidores, é calculado o rank médio do recurso.

Foi implementada também uma seção de notícias que apresenta informação sobre publicações de recursos por parte dos produtores por ordem cronológica descendente.

Para permitir que o utilizador possa navegar entre páginas foi adicionado um link para a página de utilizador com o ícone de utilizador e, se este tiver um nível acima de consumidor é-lhe apresentado botões para mudar para a página de níveis acima, uma vez que produtores e administradores também têm acesso a uma página de consumidor.

## Página do Produtor

A barra no topo da página presente na página do consumidor foi mantida para permitir navegar entre páginas, tal como na página do consumidor.

Abaixo da barra foi adicionado um botão para adicionar recurso para que redirecione o produtor para a página de adicionar recurso implementada anteriormente.

O restante conteúdo da página é relativo aos recursos publicados pelo produtor em questão.

A forma como é apresentada a informação é idêntica à página de consumidor porém, não permite comentar recursos e têm a funcionalidade de eliminar recursos dada a password do produtor.

Para implementar a funcionalidade de eliminar recurso, foi adicionada uma rota na API para eliminar um recurso. Esta testa se o utilizador em questão é o produtor daquele recurso ou um administrador. Se for o caso, terá permissão para eliminar. O recurso é eliminado da pasta "fileStore" e o registo do recurso é eliminado da base de dados. Por fim, o utilizador é redirecionado para a mesma página de forma a atualizar a informação.

## Página do Administrador

A página do administrador segue a mesma estrutura das páginas de consumidor e produtor, porém, esta permite ver toda a informação acerca de utilizadores e ficheiros bem como eliminar informação.

A implementação desta página apenas requereu novas rotas de obter informação no servidor API uma vez que já estavam implementadas as rotas de eliminar utilizadores e recursos.

Com isto, e após rever todos os casos de utilização, a construção deste serviço web deu-se por concluído.

## Docker

Para finalizar, foi criado um container em Docker para cada servidor e o código de ambos foi alterado para que, nos pedidos “axios”, fossem referidos os nomes dos containers.

Ambos os containers têm como ambiente de execução a versão 20-bullseye do node.

Foi criado um ficheiro “docker-compose.yml” para criar todos os containers (incluindo o da base de dados em mongodb) e iniciar a execução a partir da diretoria principal do projeto.

# Trabalho futuro

Futuramente, poderiam ser implementadas mais funcionalidades no sistema que o tornaram mais robusto e mais completo, tais como: páginas de erro com mensagens mais claras e uma aparência mais agradável, “password hashing” para proteger as passwords até mesmo dentro da própria base de dados e outros métodos de autenticação.
	
Para além disso, poderia ser alterado o design das páginas para algo mais visualmente apelativo e responsivo.

# Conclusão

A realização deste projeto permitiu desenvolver uma maior compreensão sobre o desenvolvimento de serviços web em NodeJS, Express e MongoDB e também no uso da tecnologia Docker para criar e gerir containers uma vez que explorou todos os tópicos abordados nas aulas lecionadas ao longo do semestre.

Considero ter cumprido, na íntegra, todos os objetivos propostos pelo enunciado do projeto ao desenvolver este sistema.

# Anexos